<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S0LACE • Media</title>

  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" href="index.css" />
  <script src="global-hub.js" defer></script>
  <script src="register-sw.js" defer></script>

  <style>
    .media-row {
      margin-top: 28px;
    }

    .media-row-title {
      font-size: 12px;
      letter-spacing: 1px;
      color: var(--fg);
      margin-bottom: 10px;
    }

    .media-row-track {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 6px;
      scrollbar-width: none;
    }
    .media-row-track::-webkit-scrollbar { display: none; }

    .media-row .media-card {
      min-width: 160px;
    }
  </style>
</head>

<body>

<nav class="side-header">
  <a href="index.html" class="side-icon" data-icon="home"><img /></a>
  <a href="games.html" class="side-icon" data-icon="games"><img /></a>
  <a href="media.html" class="side-icon" data-icon="media"><img /></a>
  <a href="settings.html" class="side-icon" data-icon="settings"><img /></a>
</nav>

<main>
  <div class="page-header">
    <h1>MEDIA</h1>
  </div>

  <!-- SEARCH -->
  <div class="games-search-wrap">
    <span class="search-label">SEARCH &gt;</span>
    <input id="media-search" type="text" placeholder="type a title and press Enter…" />
  </div>

  <!-- CONTINUE WATCHING -->
  <section class="media-row" id="continue-row" style="display:none;">
    <div class="media-row-title">CONTINUE WATCHING</div>
    <div class="media-row-track" id="continue-track"></div>
  </section>

  <!-- TRENDING -->
  <section class="media-row">
    <div class="media-row-title">TRENDING NOW</div>
    <div class="media-row-track" id="trending-row"></div>
  </section>

  <!-- ACTION -->
  <section class="media-row">
    <div class="media-row-title">ACTION</div>
    <div class="media-row-track" id="action-row"></div>
  </section>

  <!-- HORROR -->
  <section class="media-row">
    <div class="media-row-title">HORROR</div>
    <div class="media-row-track" id="horror-row"></div>
  </section>

</main>

<script>
const TMDB_KEY = "2d1351cf74f73892042699d0431b799a";
const IMG = "https://image.tmdb.org/t/p/w600_and_h900_face";
const CONTINUE_KEY = "s0lace-continue";

function poster(path){ return path ? IMG+path : "thumbs/placeholder-poster.png"; }

function movieCard(m){
  const a=document.createElement("a");
  a.className="media-card";
  a.href="#";
  a.innerHTML=`<div class="poster-thumb">
    <img src="${poster(m.poster_path)}">
    <div class="media-overlay">${m.title}</div>
  </div>`;
  a.onclick=e=>{
    e.preventDefault();
    saveContinue({id:m.id,title:m.title,poster_path:m.poster_path,type:"movie"});
    location.href=`mediaplayer.html?src=${encodeURIComponent("/scramjet/https://vidfast.pro/movie/"+m.id)}&title=${encodeURIComponent(m.title)}`;
  };
  return a;
}

function tvCard(s){
  const a=document.createElement("a");
  a.className="media-card";
  a.href="#";
  a.innerHTML=`<div class="poster-thumb">
    <img src="${poster(s.poster_path)}">
    <div class="media-overlay">${s.name}</div>
  </div>`;
  a.onclick=e=>{
    e.preventDefault();
    saveContinue({id:s.id,title:s.name,poster_path:s.poster_path,type:"tv"});
    location.href=`tvplayer.html?id=${s.id}&title=${encodeURIComponent(s.name)}&season=1&episode=1`;
  };
  return a;
}

/* CONTINUE WATCHING */
function getContinue(){return JSON.parse(localStorage.getItem(CONTINUE_KEY)||"[]");}
function saveContinue(item){
  let list=getContinue().filter(i=>i.id!==item.id);
  list.unshift(item);
  localStorage.setItem(CONTINUE_KEY,JSON.stringify(list.slice(0,12)));
}
function renderContinue(){
  const list=getContinue();
  if(!list.length)return;
  document.getElementById("continue-row").style.display="block";
  const t=document.getElementById("continue-track");
  t.innerHTML="";
  list.forEach(i=>t.appendChild(i.type==="movie"?movieCard(i):tvCard(i)));
}

/* COLLECTIONS */
async function loadRow(url,target){
  const r=await fetch(url).then(r=>r.json());
  const el=document.getElementById(target);
  r.results.slice(0,15).forEach(m=>el.appendChild(movieCard(m)));
}

document.addEventListener("DOMContentLoaded",()=>{
  renderContinue();
  loadRow(`https://api.themoviedb.org/3/trending/movie/week?api_key=${TMDB_KEY}`,"trending-row");
  loadRow(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=28`,"action-row");
  loadRow(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=27`,"horror-row");

  document.getElementById("media-search").addEventListener("keydown",e=>{
    if(e.key!=="Enter")return;
    const q=e.target.value.trim();
    if(!q)location.reload();
    fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}`)
      .then(r=>r.json()).then(d=>{
        document.querySelectorAll(".media-row-track").forEach(r=>r.innerHTML="");
        d.results.slice(0,30).forEach(m=>document.getElementById("trending-row").appendChild(movieCard(m)));
      });
  });
});

/* SIDE ICONS */
function updateSideIcons(){
  const accent=localStorage.getItem("s0laceAccent")||"gray";
  document.querySelectorAll(".side-icon").forEach(l=>{
    const icon=l.dataset.icon;
    const img=l.querySelector("img");
    const active=location.pathname.endsWith(l.getAttribute("href"));
    img.src=`thumbs/${icon}/${active?accent:"gray"}.png`;
  });
}
updateSideIcons();
window.addEventListener("storage",updateSideIcons);
</script>

</body>
</html>
